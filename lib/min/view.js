'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value' in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}})();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else {return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}(function(){var Sand=window.Sand=window.Sand||{};var su=Sand.Utils;var sv=Sand.View=(function(){function _class(container){_classCallCheck(this,_class);this._container=container;this._width=this._container.clientWidth;this._height=this._container.clientHeight;this.setUp();this._clearColor=new su.Color(0,100,50,0.1);this._grainColor=new su.Color(0,100,100,1);this._center=new su.Vector(this._width/2,3*this._height/8);this.grain=new Sand.Grain({position:new (Function.prototype.bind.apply(su.Vector,[null].concat(_toConsumableArray(this._center.toArray())))),size:2,weight:1,color:this._grainColor});this._positiondelta=5}_createClass(_class,[{key:'setUp',value:function setUp(){var _this=this;this.cvs=document.createElement('canvas');this.cvs.setAttribute('width',this._width);this.cvs.setAttribute('height',3*this._height/4);this._container.appendChild(this.cvs);this.ctx=this.cvs.getContext('2d');this._bgColorPicker=new Sand.ColorPicker(this._width/2.1,this._height/4);this._container.appendChild(this._bgColorPicker.render().el());this._fgColorPicker=new Sand.ColorPicker(this._width/2.1,this._height/4);this._container.appendChild(this._fgColorPicker.render().el());this._bgColorPicker.el().addEventListener('colorchange',function(e){_this._clearColor=new su.Color(0,100,0,0.8);_this.clear();_this._clearColor=_this._bgColorPicker.getColor();_this._clearColor.alpha(0.01)});this._fgColorPicker.el().addEventListener('colorchange',function(e){_this.grain.color=_this._grainColor=_this._fgColorPicker.getColor()})}},{key:'start',value:function start(){var _this2=this;this.cvs.addEventListener('click',function(e){_this2._positiondelta=_this2._center.distanceTo([e.offsetX,e.offsetY])/1;requestAnimationFrame(function(_){})});requestAnimationFrame(this.draw.bind(this));var counter=0;setInterval(function(_){var gp=_this2._positiondelta;_this2._positiondelta+=(gp<_this2._height/5)*(counter/20000);_this2._positiondelta-=(gp>_this2._height/4)*(counter/20000);counter+=2;counter*=counter<10000;for(var i=-30;i<30;i++){_this2.grain.position.y(_this2._center.y()+i*5+gp*Math.sin(i/30*counter/gp));for(var j=-2;j<3;j++){_this2.grain.size=10+5*Math.sin(i+counter/25)-2*j*j;_this2.grain.position.x(_this2._center.x()-i*2+j*_this2._width/10+gp*Math.cos(i+j*counter/gp));_this2.grain.render(_this2.ctx)}}},2)}},{key:'draw',value:function draw(){var ctx=this.ctx,cvs=ctx.canvas,gp=this._positiondelta;this.clear();requestAnimationFrame(this.draw.bind(this))}},{key:'clear',value:function clear(){var opacity=arguments.length<=0||arguments[0]===undefined?0.01:arguments[0];var ctx=this.ctx,cvs=ctx.canvas;ctx.fillStyle=''+this._clearColor;ctx.fillRect(0,0,cvs.width,cvs.height)}}]);return _class})()})();